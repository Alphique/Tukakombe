{% extends "base.html" %}

{% block title %}Contact Us | Tukakula{% endblock %}

{% block content %}

<div class="contact-container">
    <div class="contact-wrapper">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="alert-container">
            {% for category, message in messages %}
            <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
                <div class="alert-content">
                    <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-circle' }} me-2"></i>
                    {{ message }}
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- Header -->
        <div class="contact-header">
            <div class="contact-intro">
                <h1 class="contact-title">Get in Touch</h1>
                <p class="contact-subtitle">Fill out the form below and we'll get back to you shortly</p>
            </div>
            
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Personal Info</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Company Info</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Inquiry</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Review</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form -->
        <form method="post" action="/contact" id="contactForm" class="contact-form" novalidate>
            <!-- Step 1: Personal Information -->
            <div class="form-step active" id="step1">
                <div class="form-step-card">
                    <div class="form-step-header">
                        <h2 class="form-step-title">Personal Information</h2>
                        <p class="form-step-description">Let's start with your contact details</p>
                    </div>

                    <div class="form-step-content">
                        <div class="form-group">
                            <label for="full_name" class="form-label">
                                Full Name <span class="required">*</span>
                            </label>
                            <input type="text" class="form-control" id="full_name" name="full_name" 
                                   placeholder="Enter your full name" required>
                            <div class="invalid-feedback">Please enter your full name</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="email" class="form-label">
                                        Email Address <span class="required">*</span>
                                    </label>
                                    <input type="email" class="form-control" id="email" name="email" 
                                           placeholder="your.email@example.com" required>
                                    <div class="invalid-feedback">Please enter a valid email address</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" 
                                           placeholder="+1 (234) 567-8900">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="whatsapp" class="form-label">
                                WhatsApp Number <span class="optional">(Optional)</span>
                            </label>
                            <input type="tel" class="form-control" id="whatsapp" name="whatsapp" 
                                   placeholder="+1 (234) 567-8900">
                            <small class="form-help">For faster response and WhatsApp communication</small>
                        </div>
                    </div>

                    <div class="form-step-footer">
                        <button type="button" class="btn btn-next" data-next="2">
                            Continue <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Company Information -->
            <div class="form-step" id="step2">
                <div class="form-step-card">
                    <div class="form-step-header">
                        <h2 class="form-step-title">Company Information</h2>
                        <p class="form-step-description">Tell us about your organization</p>
                    </div>

                    <div class="form-step-content">
                        <div class="form-group">
                            <label for="company_name" class="form-label">
                                Company / Organization <span class="optional">(Optional)</span>
                            </label>
                            <input type="text" class="form-control" id="company_name" name="company_name" 
                                   placeholder="Your company name">
                        </div>

                        <div class="form-group">
                            <label for="inquiry_target" class="form-label">
                                Who are you contacting? <span class="required">*</span>
                            </label>
                            <select class="form-select" id="inquiry_target" name="inquiry_target" required>
                                <option value="">Select an option</option>
                                <option value="tukakula">Tukakula (General Inquiry)</option>
                                <option value="service">Specific Service</option>
                            </select>
                            <div class="invalid-feedback">Please select who you want to contact</div>
                        </div>

                        <div class="form-group" id="service_selector_container" style="display: none;">
                            <label for="service" class="form-label">
                                Select Service <span class="required">*</span>
                            </label>
                            <select class="form-select" id="service" name="service">
                                <option value="">-- Select a service --</option>
                                <option value="developers">Tuka Developers</option>
                                <option value="finance">Tuka Finance</option>
                                <option value="advisory">Tuka Business Advisory</option>
                                <option value="brand">Tuka Brand Studio</option>
                                <option value="marketplace">Marketplace</option>
                            </select>
                            <div class="invalid-feedback">Please select a service</div>
                        </div>
                    </div>

                    <div class="form-step-footer">
                        <button type="button" class="btn btn-outline btn-prev" data-prev="1">
                            <i class="fas fa-arrow-left me-2"></i> Back
                        </button>
                        <button type="button" class="btn btn-next" data-next="3">
                            Continue <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Inquiry Details -->
            <div class="form-step" id="step3">
                <div class="form-step-card">
                    <div class="form-step-header">
                        <h2 class="form-step-title">Inquiry Details</h2>
                        <p class="form-step-description">Tell us about your request</p>
                    </div>

                    <div class="form-step-content">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="subject" class="form-label">
                                        Subject <span class="optional">(Optional)</span>
                                    </label>
                                    <input type="text" class="form-control" id="subject" name="subject" 
                                           placeholder="Brief subject line">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="reason" class="form-label">
                                        Reason for Contact <span class="required">*</span>
                                    </label>
                                    <select class="form-select" id="reason" name="reason" required>
                                        <option value="">Select a reason</option>
                                        <option value="consultation">Consultation</option>
                                        <option value="support">Support</option>
                                        <option value="partnership">Partnership</option>
                                        <option value="pricing">Pricing Inquiry</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="invalid-feedback">Please select a reason for contact</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="message" class="form-label">
                                Message <span class="required">*</span>
                            </label>
                            <textarea class="form-control" id="message" name="message" rows="6" 
                                      placeholder="Please provide details about your inquiry..." required></textarea>
                            <div class="invalid-feedback">Please enter your message</div>
                            <small class="form-help">Be as detailed as possible to help us serve you better</small>
                        </div>
                    </div>

                    <div class="form-step-footer">
                        <button type="button" class="btn btn-outline btn-prev" data-prev="2">
                            <i class="fas fa-arrow-left me-2"></i> Back
                        </button>
                        <button type="button" class="btn btn-next" data-next="4">
                            Review <i class="fas fa-check-circle ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Review & Submit -->
            <div class="form-step" id="step4">
                <div class="form-step-card">
                    <div class="form-step-header">
                        <h2 class="form-step-title">Review & Submit</h2>
                        <p class="form-step-description">Please review all information before submitting</p>
                    </div>

                    <div class="form-step-content">
                        <!-- Personal Information Review -->
                        <div class="review-section">
                            <h5 class="review-section-title">
                                <i class="fas fa-user-circle me-2"></i>
                                Personal Information
                            </h5>
                            <div class="review-grid">
                                <div class="review-item">
                                    <span class="review-label">Full Name:</span>
                                    <span class="review-value" id="review_full_name"></span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Email:</span>
                                    <span class="review-value" id="review_email"></span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Phone:</span>
                                    <span class="review-value" id="review_phone">Not provided</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">WhatsApp:</span>
                                    <span class="review-value" id="review_whatsapp">Not provided</span>
                                </div>
                            </div>
                        </div>

                        <!-- Company Information Review -->
                        <div class="review-section">
                            <h5 class="review-section-title">
                                <i class="fas fa-building me-2"></i>
                                Company Information
                            </h5>
                            <div class="review-grid">
                                <div class="review-item">
                                    <span class="review-label">Company:</span>
                                    <span class="review-value" id="review_company">Not provided</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Contacting:</span>
                                    <span class="review-value" id="review_target"></span>
                                </div>
                                <div class="review-item" id="review_service_item" style="display: none;">
                                    <span class="review-label">Service:</span>
                                    <span class="review-value" id="review_service"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Inquiry Details Review -->
                        <div class="review-section">
                            <h5 class="review-section-title">
                                <i class="fas fa-envelope-open-text me-2"></i>
                                Inquiry Details
                            </h5>
                            <div class="review-grid">
                                <div class="review-item">
                                    <span class="review-label">Subject:</span>
                                    <span class="review-value" id="review_subject">Not specified</span>
                                </div>
                                <div class="review-item">
                                    <span class="review-label">Reason:</span>
                                    <span class="review-value" id="review_reason"></span>
                                </div>
                                <div class="review-item full-width">
                                    <span class="review-label">Message:</span>
                                    <div class="review-message" id="review_message"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Notice -->
                        <div class="review-notice">
                            <i class="fas fa-clock me-2"></i>
                            <div>
                                <strong>Response Time:</strong>
                                <p>We typically respond within 24-48 hours. Urgent inquiries with WhatsApp numbers may receive faster responses.</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-step-footer">
                        <button type="button" class="btn btn-outline btn-prev" data-prev="3">
                            <i class="fas fa-arrow-left me-2"></i> Edit
                        </button>
                        <button type="submit" class="btn btn-submit">
                            <i class="fas fa-paper-plane me-2"></i> Send Inquiry
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Contact Info Sidebar -->
        <div class="contact-info-sidebar">
            <div class="contact-info-card">
                <h4 class="info-card-title">
                    <i class="fas fa-headset me-2"></i>
                    Need Help?
                </h4>
                <div class="info-items">
                    <div class="info-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <strong>Email Support</strong>
                            <p>support@tukakula.com</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <strong>Call Us</strong>
                            <p>+1 (234) 567-8900</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fab fa-whatsapp"></i>
                        <div>
                            <strong>WhatsApp</strong>
                            <p>+1 (234) 567-8900</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <div>
                            <strong>Response Time</strong>
                            <p>24-48 hours</p>
                        </div>
                    </div>
                </div>
                
                <div class="info-tips">
                    <h5><i class="fas fa-lightbulb me-2"></i>Tips for Quick Response</h5>
                    <ul>
                        <li>Include your WhatsApp for urgent matters</li>
                        <li>Be specific about your needs</li>
                        <li>Mention your preferred contact method</li>
                        <li>Provide relevant background information</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Container and Layout */
    .contact-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #f8fafc 0%, #eef2f7 100%);
        padding: 40px 20px;
    }
    
    .contact-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 40px;
        align-items: start;
    }
    
    @media (max-width: 992px) {
        .contact-wrapper {
            grid-template-columns: 1fr;
            gap: 30px;
        }
    }
    
    /* Header */
    .contact-header {
        grid-column: 1 / -1;
        margin-bottom: 40px;
    }
    
    .contact-intro {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .contact-title {
        font-size: 42px;
        font-weight: 700;
        color: #1a2a40;
        margin-bottom: 16px;
        line-height: 1.2;
    }
    
    .contact-subtitle {
        font-size: 18px;
        color: #64748b;
        max-width: 600px;
        margin: 0 auto;
    }
    
    /* Progress Steps */
    .progress-steps {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .steps {
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    
    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
    }
    
    .step-number {
        width: 48px;
        height: 48px;
        background: #e2e8f0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: #64748b;
        font-size: 18px;
        margin-bottom: 12px;
        border: 3px solid white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    
    .step.active .step-number {
        background: linear-gradient(135deg, #1a2a40 0%, #2a3a55 100%);
        color: white;
        transform: scale(1.1);
        box-shadow: 0 8px 16px rgba(26, 42, 64, 0.2);
    }
    
    .step.completed .step-number {
        background: #a2d242;
        color: white;
    }
    
    .step-label {
        font-size: 14px;
        font-weight: 500;
        color: #64748b;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .step.active .step-label {
        color: #1a2a40;
        font-weight: 600;
    }
    
    .step-connector {
        flex: 1;
        height: 2px;
        background: #e2e8f0;
        margin: 0 20px;
        position: relative;
        top: -20px;
        max-width: 100px;
    }
    
    .step-connector.completed {
        background: #a2d242;
    }
    
    /* Form Steps */
    .form-step {
        display: none;
        animation: slideIn 0.3s ease;
    }
    
    .form-step.active {
        display: block;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .form-step-card {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }
    
    .form-step-header {
        margin-bottom: 32px;
        padding-bottom: 24px;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .form-step-title {
        font-size: 28px;
        font-weight: 600;
        color: #1a2a40;
        margin-bottom: 8px;
    }
    
    .form-step-description {
        font-size: 16px;
        color: #64748b;
        margin: 0;
    }
    
    .form-step-content {
        margin-bottom: 32px;
    }
    
    .form-step-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 32px;
        border-top: 1px solid #e2e8f0;
    }
    
    /* Form Elements */
    .form-group {
        margin-bottom: 24px;
    }
    
    .form-label {
        display: block;
        font-weight: 500;
        color: #1a2a40;
        margin-bottom: 8px;
        font-size: 14px;
    }
    
    .required {
        color: #ef4444;
    }
    
    .optional {
        color: #64748b;
        font-weight: normal;
        font-size: 12px;
    }
    
    .form-control, .form-select {
        padding: 12px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        font-size: 15px;
        transition: all 0.3s;
        width: 100%;
    }
    
    .form-control:focus, .form-select:focus {
        outline: none;
        border-color: #1a2a40;
        box-shadow: 0 0 0 3px rgba(26, 42, 64, 0.1);
    }
    
    .form-control.is-invalid, .form-select.is-invalid {
        border-color: #ef4444;
    }
    
    .invalid-feedback {
        color: #ef4444;
        font-size: 13px;
        margin-top: 6px;
        display: none;
    }
    
    .is-invalid ~ .invalid-feedback {
        display: block;
    }
    
    .form-help {
        display: block;
        color: #64748b;
        font-size: 13px;
        margin-top: 6px;
    }
    
    /* Buttons */
    .btn {
        padding: 12px 32px;
        border-radius: 12px;
        font-weight: 500;
        font-size: 15px;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    .btn-next, .btn-submit {
        background: linear-gradient(135deg, #1a2a40 0%, #2a3a55 100%);
        color: white;
        min-width: 140px;
    }
    
    .btn-next:hover, .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(26, 42, 64, 0.3);
    }
    
    .btn-outline {
        background: white;
        color: #1a2a40;
        border: 1px solid #e2e8f0;
    }
    
    .btn-outline:hover {
        background: #f8fafc;
        border-color: #cbd5e1;
    }
    
    .btn-submit {
        background: linear-gradient(135deg, #a2d242 0%, #8ab82d 100%);
    }
    
    .btn-submit:hover {
        box-shadow: 0 8px 20px rgba(162, 210, 66, 0.3);
    }
    
    /* Review Section */
    .review-section {
        background: #f8fafc;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        border: 1px solid #e2e8f0;
    }
    
    .review-section-title {
        font-size: 18px;
        font-weight: 600;
        color: #1a2a40;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
    }
    
    .review-section-title i {
        color: #a2d242;
    }
    
    .review-grid {
        display: grid;
        gap: 16px;
    }
    
    .review-item {
        display: flex;
        align-items: flex-start;
    }
    
    .review-label {
        font-weight: 500;
        color: #64748b;
        min-width: 120px;
        font-size: 14px;
    }
    
    .review-value {
        color: #1a2a40;
        font-weight: 500;
        flex: 1;
    }
    
    .review-item.full-width {
        flex-direction: column;
        gap: 8px;
    }
    
    .review-message {
        background: white;
        padding: 16px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 14px;
        line-height: 1.6;
    }
    
    .review-notice {
        background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: flex-start;
        gap: 16px;
        margin-top: 32px;
    }
    
    .review-notice i {
        color: #1a2a40;
        font-size: 20px;
        margin-top: 4px;
    }
    
    .review-notice strong {
        color: #1a2a40;
        display: block;
        margin-bottom: 4px;
    }
    
    .review-notice p {
        color: #475569;
        margin: 0;
        font-size: 14px;
    }
    
    /* Contact Info Sidebar */
    .contact-info-sidebar {
        position: sticky;
        top: 40px;
    }
    
    .contact-info-card {
        background: white;
        border-radius: 20px;
        padding: 32px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }
    
    .info-card-title {
        font-size: 20px;
        font-weight: 600;
        color: #1a2a40;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
    }
    
    .info-items {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 32px;
    }
    
    .info-item {
        display: flex;
        align-items: center;
        gap: 16px;
    }
    
    .info-item i {
        width: 40px;
        height: 40px;
        background: #f8fafc;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #1a2a40;
        font-size: 16px;
        flex-shrink: 0;
    }
    
    .info-item strong {
        display: block;
        color: #1a2a40;
        font-size: 14px;
        margin-bottom: 2px;
    }
    
    .info-item p {
        color: #64748b;
        margin: 0;
        font-size: 14px;
    }
    
    .info-tips {
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
    }
    
    .info-tips h5 {
        font-size: 16px;
        font-weight: 600;
        color: #1a2a40;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
    }
    
    .info-tips ul {
        margin: 0;
        padding-left: 20px;
    }
    
    .info-tips li {
        color: #475569;
        font-size: 14px;
        margin-bottom: 8px;
        line-height: 1.5;
    }
    
    .info-tips li:last-child {
        margin-bottom: 0;
    }
    
    /* Alerts */
    .alert-container {
        grid-column: 1 / -1;
        margin-bottom: 24px;
    }
    
    .alert {
        border-radius: 12px;
        border: none;
        padding: 16px 20px;
        margin-bottom: 16px;
    }
    
    .alert-success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
    }
    
    .alert-danger {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
    }
    
    .alert-content {
        display: flex;
        align-items: center;
    }
    
    .btn-close {
        padding: 0.75rem;
        background-size: 0.75rem;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .contact-container {
            padding: 20px 16px;
        }
        
        .contact-title {
            font-size: 32px;
        }
        
        .contact-subtitle {
            font-size: 16px;
        }
        
        .form-step-card {
            padding: 24px;
        }
        
        .step-number {
            width: 36px;
            height: 36px;
            font-size: 16px;
        }
        
        .step-connector {
            margin: 0 12px;
            max-width: 60px;
        }
        
        .form-step-footer {
            flex-direction: column;
            gap: 16px;
        }
        
        .btn, .btn-outline {
            width: 100%;
            justify-content: center;
        }
        
        .contact-info-card {
            padding: 24px;
        }
        
        .info-item {
            flex-wrap: wrap;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let currentStep = 1;
        const form = document.getElementById('contactForm');
        const steps = document.querySelectorAll('.form-step');
        const stepElements = document.querySelectorAll('.step');
        const inquiryTarget = document.getElementById('inquiry_target');
        const serviceContainer = document.getElementById('service_selector_container');
        const serviceSelect = document.getElementById('service');
        
        // Initialize form validation
        form.addEventListener('submit', function(event) {
            if (!validateStep(currentStep)) {
                event.preventDefault();
                event.stopPropagation();
            }
        });
        
        // Initialize service selector
        function toggleServiceSelector() {
            if (inquiryTarget.value === 'service') {
                serviceContainer.style.display = 'block';
                serviceSelect.required = true;
            } else {
                serviceContainer.style.display = 'none';
                serviceSelect.required = false;
                serviceSelect.value = '';
            }
        }
        
        inquiryTarget.addEventListener('change', toggleServiceSelector);
        toggleServiceSelector(); // Initialize on load
        
        // Step navigation
        document.querySelectorAll('.btn-next').forEach(button => {
            button.addEventListener('click', function() {
                const nextStep = parseInt(this.dataset.next);
                if (validateStep(currentStep)) {
                    if (nextStep === 4) {
                        populateReview();
                    }
                    goToStep(nextStep);
                }
            });
        });
        
        document.querySelectorAll('.btn-prev').forEach(button => {
            button.addEventListener('click', function() {
                const prevStep = parseInt(this.dataset.prev);
                goToStep(prevStep);
            });
        });
        
        function goToStep(step) {
            // Hide all steps
            steps.forEach(s => s.classList.remove('active'));
            
            // Show target step
            document.getElementById(`step${step}`).classList.add('active');
            
            // Update progress indicators
            stepElements.forEach(stepEl => {
                stepEl.classList.remove('active', 'completed');
                const stepNumber = parseInt(stepEl.dataset.step);
                if (stepNumber < step) {
                    stepEl.classList.add('completed');
                } else if (stepNumber === step) {
                    stepEl.classList.add('active');
                }
            });
            
            // Update step connectors
            document.querySelectorAll('.step-connector').forEach((connector, index) => {
                if (index < step - 1) {
                    connector.classList.add('completed');
                } else {
                    connector.classList.remove('completed');
                }
            });
            
            currentStep = step;
            scrollToTop();
        }
        
        function validateStep(step) {
            const currentForm = document.getElementById(`step${step}`);
            const requiredFields = currentForm.querySelectorAll('[required]');
            let isValid = true;
            
            // Clear previous validation
            requiredFields.forEach(field => {
                field.classList.remove('is-invalid');
            });
            
            // Validate each field
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else if (field.type === 'email' && !validateEmail(field.value)) {
                    field.classList.add('is-invalid');
                    isValid = false;
                }
            });
            
            // Special validation for step 2
            if (step === 2) {
                if (inquiryTarget.value === 'service' && !serviceSelect.value) {
                    serviceSelect.classList.add('is-invalid');
                    serviceContainer.style.display = 'block';
                    isValid = false;
                }
            }
            
            return isValid;
        }
        
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function populateReview() {
            // Personal info
            document.getElementById('review_full_name').textContent = document.getElementById('full_name').value;
            document.getElementById('review_email').textContent = document.getElementById('email').value;
            document.getElementById('review_phone').textContent = document.getElementById('phone').value || 'Not provided';
            document.getElementById('review_whatsapp').textContent = document.getElementById('whatsapp').value || 'Not provided';
            
            // Company info
            document.getElementById('review_company').textContent = document.getElementById('company_name').value || 'Not provided';
            const targetText = inquiryTarget.options[inquiryTarget.selectedIndex].text;
            document.getElementById('review_target').textContent = targetText;
            
            // Service info
            if (inquiryTarget.value === 'service' && serviceSelect.value) {
                const serviceText = serviceSelect.options[serviceSelect.selectedIndex].text;
                document.getElementById('review_service').textContent = serviceText;
                document.getElementById('review_service_item').style.display = 'flex';
            } else {
                document.getElementById('review_service_item').style.display = 'none';
            }
            
            // Inquiry info
            document.getElementById('review_subject').textContent = document.getElementById('subject').value || 'Not specified';
            document.getElementById('review_reason').textContent = document.getElementById('reason').options[document.getElementById('reason').selectedIndex].text;
            document.getElementById('review_message').textContent = document.getElementById('message').value;
        }
        
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Phone number formatting
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length === 0) return '';
            
            // Format as +1 (234) 567-8900
            let formatted = '+';
            if (value.length > 0) {
                formatted += value.substring(0, Math.min(value.length, 3));
            }
            if (value.length > 3) {
                formatted += ' (' + value.substring(3, Math.min(value.length, 6));
            }
            if (value.length > 6) {
                formatted += ') ' + value.substring(6, Math.min(value.length, 9));
            }
            if (value.length > 9) {
                formatted += '-' + value.substring(9, Math.min(value.length, 13));
            }
            input.value = formatted;
        }
        
        // Add phone formatting
        document.getElementById('phone').addEventListener('input', function() {
            formatPhoneNumber(this);
        });
        
        document.getElementById('whatsapp').addEventListener('input', function() {
            formatPhoneNumber(this);
        });
        
        // Initialize with step 1
        goToStep(1);
    });
</script>
{% endblock %}