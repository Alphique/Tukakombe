{% extends "blog_base.html" %}

{% block title %}Admin Dashboard | Tuka Advisory{% endblock %}

{% block content %}
<div class="dashboard-container">
    <header class="dashboard-header">
        <div class="header-content">
            <h1 class="dashboard-title">Admin Dashboard</h1>
            <p class="welcome-message">
                Welcome back, 
                <span class="user-role">
                    {% if session.get('role') in ['admin', 'super_admin', 'blog_admin'] %}
                        {{ session.get('role')|replace('_', ' ')|title }}
                    {% else %}
                        {{ session.get('username') }}
                    {% endif %}
                </span>
            </p>
        </div>
        <div class="header-stats">
            <div class="stat-card">
                <span class="stat-number">{{ blogs|length if blogs else 0 }}</span>
                <span class="stat-label">Total Blogs</span>
            </div>
            <div class="stat-card">
                <span class="stat-number"><i class="fas fa-users" style="font-size: 1.2rem;"></i></span>
                <span class="stat-label">Active Users</span>
            </div>
        </div>
    </header>

    <div class="dashboard-grid">
        <section class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-edit card-icon"></i>
                    Blog Management
                </h2>
            </div>
            <div class="card-body">
                <div class="action-buttons">
                    <a href="{{ url_for('admin.create_blog') }}" class="action-btn primary">
                        <span><i class="fas fa-plus-circle"></i> Create New Blog</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                    <a href="{{ url_for('blog.blog_home') }}" class="action-btn secondary">
                        <span><i class="fas fa-eye"></i> View All Blogs</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                    <a href="#manage-blogs" class="action-btn secondary">
                        <span><i class="fas fa-tasks"></i> Manage Content</span>
                        <i class="fas fa-chevron-down"></i>
                    </a>
                </div>
            </div>
        </section>


        {% if session.get('role') == 'super_admin' %}
        <section class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-users-cog card-icon"></i>
                    User Management
                </h2>
            </div>
            <div class="card-body">
                <div class="action-buttons">
                    <a href="{{ url_for('admin.login') }}" class="action-btn primary">
                        <span>View All Users</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                    <a href="#" class="action-btn secondary">
                        <span>Create Admin/Staff</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </section>
        {% endif %}

        <section class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-hand-holding-usd card-icon"></i>
                    Finance / Loans
                </h2>
            </div>
            <div class="card-body">
                <div class="action-buttons">
                    <!-- Dashboard or menu -->
<a href="{{ url_for('admin.list_loans') }}" class="action-btn primary">

                        <span>View & Approve Loans</span>
                        <i class="fas fa-check-circle"></i>
                    </a>
                </div>
            </div>
        </section>


        <section class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-users-cog card-icon"></i>
                    Market Place Products
                </h2>
            </div>
            <div class="card-body">
                <div class="action-buttons">
                    <a href="{{ url_for('admin.create_product') }}" class="action-btn primary">
                        <span>Add Marketplace Product</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                    <a href="{{ url_for('admin.product_inquiries_view') }}" class="action-btn secondary">
                        <span>View Product Inquiries</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </section>

        <section class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-edit card-icon"></i>
                    Queries and Inquiries
                </h2>
            </div>
            <div class="card-body">
                <div class="action-buttons">
                    <a href="{{ url_for('admin.tukakula_queries') }}" class="action-btn primary">
                        <span><i class="fas fa-plus-circle"></i> View Queries</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </section>

        <section class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-terminal card-icon"></i>
                    System Logs
                </h2>
            </div>
            <div class="card-body">
                <div class="action-buttons">
                    <a href="{{ url_for('admin.login') }}" class="action-btn primary">
                        <span>View & Delete Logs</span>
                        <i class="fas fa-history"></i>
                    </a>
                </div>
            </div>
        </section>
    </div>

    <section id="manage-blogs" class="content-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-list-ul section-icon"></i>
                Manage Blogs & Comments
            </h2>
            <p class="section-subtitle">Perform quick edits or moderate community discussions.</p>
        </div>

    <section id="manage-blogs" class="content-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-list-ul section-icon"></i>
                Manage Blogs & Comments
            </h2>
            <p class="section-subtitle">Perform quick edits or moderate community discussions.</p>
        </div>

        <div class="blogs-list">
            {% for blog in blogs %}
            <div class="blog-card-admin">
                <div class="blog-admin-header">
                    <div class="blog-info">
                        <h3 class="blog-title">{{ blog['title'] }}</h3>
                        <p class="blog-meta">
                            <span class="meta-item"><i class="far fa-calendar-alt"></i> {{ blog['created_at'] }}</span>
                            {% if blog['comments'] %}
                            <span class="meta-item"><i class="far fa-comment"></i> {{ blog['comments']|length }} comments</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="blog-actions">
                        <a href="{{ url_for('admin.edit_blog', blog_id=blog['id']) }}" class="btn-edit">
                            <i class="fas fa-pen"></i> Edit
                        </a>
                        <form method="POST" action="{{ url_for('admin.delete_blog', blog_id=blog['id']) }}" class="delete-form">
                            <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this blog?');">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>

                {% if blog['comments'] %}
                <div class="comments-accordion">
                    <h4 class="comments-title">User Comments</h4>
                    <div class="comments-list">
                        {% for comment in blog['comments'] %}
                        <div class="comment-item-admin">
                            <div class="comment-content">
                                <div class="comment-header-admin">
                                    <span class="comment-author">{{ comment['user_email'] }}</span>
                                    <span class="comment-time">Recently</span>
                                </div>
                                <p class="comment-text">{{ comment['content'] }}</p>
                            </div>
                            <form method="POST" action="{{ url_for('blog.delete_comment', comment_id=comment['id']) }}">
                                <button type="submit" class="btn-delete-sm" title="Remove Comment" onclick="return confirm('Delete this comment?');">
                                    <i class="fas fa-times-circle"></i>
                                </button>
                            </form>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon"><i class="fas fa-feather-alt"></i></div>
                <h3>No blogs available</h3>
                <p>Your insight library is currently empty.</p>
                <a href="{{ url_for('admin.create_blog') }}" class="nav-btn primary">Create First Blog</a>
            </div>
            {% endfor %}
        </div>
    </section>
</div>

<style>
    /* Admin Specific Styles using Base Variables */
    .dashboard-container {
        padding: 40px 5%;
        max-width: 1400px;
        margin: 0 auto;
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 40px;
        border-bottom: 1px solid rgba(162, 210, 66, 0.2);
        padding-bottom: 20px;
    }

    .dashboard-title {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--navy);
        margin-bottom: 5px;
    }

    .user-role {
        color: var(--lime-dark);
        font-weight: 700;
    }

    /* Stats Cards */
    .header-stats { display: flex; gap: 15px; }
    .stat-card {
        background: var(--navy);
        padding: 15px 25px;
        border-radius: var(--radius-md);
        text-align: center;
        min-width: 120px;
        color: var(--white);
        box-shadow: var(--shadow-sm);
    }
    .stat-number { display: block; font-size: 1.8rem; font-weight: 800; color: var(--lime); }
    .stat-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; }

    /* Dashboard Grid */
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 25px;
        margin-bottom: 50px;
    }

    .dashboard-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 25px;
        border: 1px solid var(--gray-medium);
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
        border-color: var(--lime);
    }

    .card-title {
        font-size: 1.2rem;
        color: var(--navy);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .card-icon { color: var(--lime-dark); }

    /* Action Buttons */
    .action-buttons { display: flex; flex-direction: column; gap: 10px; }
    .action-btn {
        padding: 12px 18px;
        border-radius: var(--radius-md);
        text-decoration: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        font-size: 0.9rem;
        transition: var(--transition);
    }

    .action-btn.primary { background: var(--lime); color: var(--navy-dark); }
    .action-btn.secondary { background: var(--gray-light); color: var(--navy); border: 1px solid var(--gray-medium); }
    .action-btn:hover { padding-left: 22px; filter: brightness(1.05); }

    /* Blog Management List */
    .content-section {
        background: var(--gray-light);
        padding: 40px;
        border-radius: var(--radius-lg);
        border: 1px solid var(--gray-medium);
    }

    .section-title { color: var(--navy); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
    .section-subtitle { color: var(--gray-dark); margin-bottom: 30px; font-size: 0.95rem; }

    .blog-card-admin {
        background: var(--white);
        margin-bottom: 20px;
        padding: 20px;
        border-radius: var(--radius-md);
        border-left: 5px solid var(--navy);
        box-shadow: var(--shadow-sm);
    }

    .blog-admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .blog-title { font-size: 1.1rem; color: var(--navy); margin-bottom: 5px; }
    .blog-meta { font-size: 0.8rem; color: var(--gray-dark); display: flex; gap: 15px; }

    .blog-actions { display: flex; gap: 10px; }
    .btn-edit, .btn-delete {
        padding: 8px 15px;
        border-radius: var(--radius-sm);
        font-size: 0.8rem;
        font-weight: 700;
        text-decoration: none;
        border: none;
        cursor: pointer;
    }

    .btn-edit { background: #eef2ff; color: #4f46e5; }
    .btn-delete { background: #fef2f2; color: #dc2626; }
    .btn-edit:hover { background: #4f46e5; color: white; }
    .btn-delete:hover { background: #dc2626; color: white; }

    /* Comments Section */
    .comments-accordion { margin-top: 20px; padding-top: 15px; border-top: 1px dashed var(--gray-medium); }
    .comments-title { font-size: 0.8rem; text-transform: uppercase; color: var(--gray-dark); margin-bottom: 15px; }
    .comment-item-admin {
        display: flex;
        justify-content: space-between;
        background: var(--gray-light);
        padding: 10px 15px;
        border-radius: var(--radius-sm);
        margin-bottom: 8px;
    }
    .comment-author { font-weight: 700; font-size: 0.85rem; color: var(--navy); }
    .comment-text { font-size: 0.85rem; color: var(--navy-light); }
    .btn-delete-sm { background: none; border: none; color: #dc2626; cursor: pointer; font-size: 1.1rem; opacity: 0.6; }
    .btn-delete-sm:hover { opacity: 1; }

    /* Empty State */
    .empty-state { text-align: center; padding: 60px; }
    .empty-icon { font-size: 3rem; color: var(--gray-medium); margin-bottom: 20px; }

    @media (max-width: 768px) {
        .dashboard-header { flex-direction: column; align-items: flex-start; gap: 20px; }
        .blog-admin-header { flex-direction: column; align-items: flex-start; gap: 15px; }
        .blog-actions { width: 100%; }
        .btn-edit, .btn-delete { flex: 1; text-align: center; }
    }
</style>
{% endblock %}